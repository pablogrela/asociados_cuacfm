<!--

    Copyright (C) 2015 Pablo Grela Palleiro (pablogp_9@hotmail.com)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<title th:text="#{program.titleCreate}"></title>
<object th:include="fragments/head :: head" th:remove="tag"></object>
</head>
<body>

	<!-- Generic Header -->
	<div th:replace="fragments/header :: header(active='program')">&nbsp;</div>

	<div class="form-narrow">

		<form class="form-horizontal ws-validate" method="post" th:action="@{programCreate}" th:object="${programForm}">

			<!--/* Show general error message when form contains errors */-->
			<th:block th:if="${#fields.hasErrors('${programForm.*}')}">
				<div th:replace="fragments/alert :: alert (type='danger', message=#{form.error})">Alert</div>
			</th:block>

			<fieldset>

				<!-- Message help-->
				<legend th:text="#{program.infoCreate}">Create Program</legend>


				<!-- Insert Name -->
				<div class="form-group" th:classappend="${#fields.hasErrors('name')}? 'has-error'">
					<label for="name" class="col-lg-2 control-label" th:text="#{name}">Name</label>
					<div class="col-lg-10">
						<input type="text" class="form-control" id="name" th:placeholder="#{name}" th:field="*{name}" maxlength="30" required="required" />
						<span class="help-block with-errors" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Incorrect name</span>
						<div class="ws-errorbox" hidden=""></div>
					</div>
				</div>

				<!-- Insert Description -->
				<div class="form-group" th:classappend="${#fields.hasErrors('description')}? 'has-error'">
					<label for="password" class="col-lg-2 control-label" th:text="#{description}">Description</label>
					<div class="col-lg-10">
						<textarea class="form-control" id="description" th:placeholder="#{program.description}" th:field="*{description}" rows="5" cols="40"
							maxlength="500" required="required">
            	Description</textarea>
						<span class="help-block" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">Incorrect description</span>
						<div class="ws-errorbox" hidden=""></div>
					</div>
				</div>

				<!-- Insert Periodicity -->
				<div class="form-group" th:classappend="${#fields.hasErrors('periodicity')}? 'has-error'">
					<label for="periodicity" class="col-lg-2 control-label" th:text="#{periodicity}">place</label>
					<div class="col-lg-10">
						<div class="col-lg-4-edit">
							<input type="number" class="form-control" id="periodicity" th:placeholder="#{periodicity}" th:field="*{periodicity}" step="0.25" min="0.25"
								max="7" required="required" />
						</div>
						<span class="col-lg-2-right control-label" th:text="#{program.times}">times</span>
						<br></br>
						<span class="col-lg-10-edit help-block" th:if="${#fields.hasErrors('periodicity')}" th:errors="*{periodicity}"> Incorrect periodicity</span>
						<div class="ws-errorbox" hidden=""></div>
					</div>
				</div>

				<!-- Insert Duration -->
				<div class="form-group" th:classappend="${#fields.hasErrors('duration')}? 'has-error'">
					<label for="duration" class="col-lg-2 control-label" th:text="#{duration}">place</label>
					<div class="col-lg-10">
						<div class="col-lg-4-edit">
							<input type="number" class="form-control" id="duration" th:placeholder="#{duration}" th:field="*{duration}" min="1" required="required" />
						</div>
						<span class="col-lg-2-right control-label" th:text="#{hours}">hours</span>
						<br></br>
						<span class="col-lg-10-edit help-block" th:if="${#fields.hasErrors('duration')}" th:errors="*{duration}"> Incorrect duration</span>
						<div class="ws-errorbox" hidden=""></div>
					</div>
				</div>


				<!-- Insert Login -->
				<div class="form-group" th:classappend="${#fields.hasErrors('login')}? 'has-error'">
					<!-- Form add user by admin -->
					<th:block sec:authorize="hasAnyRole('ROLE_ADMIN')">
						<label for="login" class="col-lg-2 control-label" th:text="#{login}">Login</label>

						<div class="col-lg-9 text-danger">
							<input type="text" class="form-control" list="userlist" th:placeholder="#{login}" th:field="*{login}" autocomplete="off" />

							<!-- Datalist is a search by keyword-->
							<datalist id="userlist">
								<option th:each="username : ${usernames}" th:value="${username}" />
							</datalist>

							<span class="help-block" th:if="${#fields.hasErrors('login')}" th:errors="*{login}">Incorrect login</span>
							<div class="ws-errorbox" hidden=""></div>
						</div>
					</th:block>

					<!-- Form add user by no admin -->
					<th:block sec:authorize="!hasAnyRole('ROLE_ADMIN')">
						<label for="login" class="col-lg-2 control-label" th:text="#{dni}">DNI</label>

						<div class="col-lg-9 text-danger">
							<input type="text" class="form-control" th:placeholder="#{dni}" th:field="*{login}" th:title="#{program.infoAddUserByDni}" autocomplete="off" />
							<span class="help-block" th:if="${#fields.hasErrors('login')}" th:errors="*{login}">Incorrect login</span>
							<div class="ws-errorbox" hidden=""></div>
						</div>
					</th:block>

					<!-- Button Add User to Program-->
					<button type="submit" th:name="addUser" class="btnTable btn-link glyphicon glyphicon-plus-sign" th:title="#{inscription.addUser}"
						style="color: green"></button>

				</div>

				<!-- List of users pertains to program -->
				<table class="dataTable display table-striped">
					<thead class="table-bordered">
						<tr>
							<th th:text="#{nameAdd}">Name</th>
							<th class="no-sort"></th>
						</tr>
					</thead>
					<tbody class="table-bordered">
						<tr th:each="account : ${programForm.accounts}">
							<td th:text="${account.name}"></td>
							<!-- Delete User to Program -->
							<td>
								<button type="submit" th:value="${account.id}" th:name="removeUser" class="btnTable btn-link glyphicon glyphicon-remove-sign"
									th:title="#{account.infoRemove}" style="color: red"></button>

							</td>
						</tr>
					</tbody>
				</table>


				<!-- Form add account payer -->
				<table class="dataTable display table-striped">
					<thead class="table-bordered">
						<tr>
							<th th:text="#{program.acountPayer}">Name</th>
							<th class="no-sort"></th>
						</tr>
					</thead>
					<tbody class="table-bordered">
						<tr>
							<th th:classappend="${#fields.hasErrors('accountPayerName')}? 'has-error'">
								<!-- Form add account payer by admin --> <th:block sec:authorize="hasAnyRole('ROLE_ADMIN')">
									<div class="col-lg-9 text-danger">
										<input type="text" class="form-control" list="userlist" th:placeholder="#{program.acountPayer}" th:field="*{accountPayerName}"
											autocomplete="off" />

										<!-- Datalist is a search by keyword-->
										<datalist id="userlist">
											<option th:each="username : ${usernames}" th:value="${username}" />
										</datalist>

										<span class="help-block" th:if="${#fields.hasErrors('accountPayerName')}" th:errors="*{accountPayerName}"> Incorrect accountPayerName</span>
										<div class="ws-errorbox" hidden=""></div>
									</div>
								</th:block> <!-- Form add account payer by no admin --> <th:block sec:authorize="!hasAnyRole('ROLE_ADMIN')">
									<label for="login" class="col-lg-2 control-label" th:text="#{dni}">DNI</label>
									<div class="col-lg-9 text-danger">
										<input type="text" class="form-control" th:placeholder="#{dni}" th:field="*{accountPayerName}" th:title="#{program.infoAccountPayerByDni}"
											autocomplete="off" />
										<span class="help-block" th:if="${#fields.hasErrors('accountPayerName')}" th:errors="*{accountPayerName}"> Incorrect accountPayerName</span>
										<div class="ws-errorbox" hidden=""></div>
									</div>
								</th:block>
							</th>
							<!-- Comfirm Account Payer -->
							<td>
								<button th:if="${programForm.accountPayer} == null" type="submit" th:value="*{accountPayerName}" th:name="addAccountPayer"
									class="btnTable btn-link glyphicon glyphicon-ok" th:title="#{program.infoAddAcountPayer}" style="color: green"></button> <!-- Remove Account Payer -->
								<button type="submit" th:if="${programForm.accountPayer} != null" th:value="*{accountPayerName}" th:name="removeAccountPayer"
									class="btnTable btn-link glyphicon glyphicon-remove" th:title="#{program.infoRemoveAccountPayer}" style="color: red"></button>
							</td>
						</tr>
					</tbody>
				</table>

				<!-- Button Create Account -->
				<div class="form-group">
					<div class="col-lg-offset-2 col-lg-10">
						<button type="submit" th:name="create" th:value="create" class="btn btn-success btn-lg" th:text="#{program.create}">Create</button>
					</div>
				</div>

			</fieldset>

		</form>


	</div>
</body>
</html>